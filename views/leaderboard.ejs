<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaderboard | GameHub</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/regular/style.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/leaderboard.css" />
  </head>
  <body>
    <%- include('./components/navbars/navbar-games.ejs', { wallet: wallet }) %>
    <%- include('./components/notify-card.ejs') %>

    <section class="hero">
      <div class="hero-content">
        <h2>Global Leaderboard</h2>
        <p>
          Discover the top players across all tournaments. Track their
          performance, earnings, and achievements in competitive gaming.
        </p>

        <div class="search-container">
          <div class="search-bar">
            <input type="text" placeholder="Search players..." />
            <button><i class="fas fa-search"></i> Search</button>
          </div>
        </div>

        <div class="filters">
          <div class="filter-btn active game-type" data-game="all-games">
            All Games
          </div>
          <div class="filter-btn game-type" data-game="bgmi">BGMI</div>
          <div class="filter-btn game-type" data-game="ff">Free-Fire</div>
        </div>
      </div>
    </section>

    <div class="container">
      <div class="section-title">
        <h3><i class="fas fa-crown"></i> Top Players</h3>
        <span>Updated: Today</span>
      </div>

      <div class="podium">
        <!-- 1st Place -->

        <div class="podium-player">
          <div class="podium-rank podium-1">1</div>
          <div class="podium-avatar">
            <img
              src="https://static.vecteezy.com/system/resources/thumbnails/054/555/561/small/a-man-wearing-headphones-and-sunglasses-is-wearing-a-hoodie-free-vector.jpg"
              alt="Player Avatar"
            />
          </div>
          <div class="podium-name rank-1-name"><%= usersList[0].ign %></div>
          <div class="podium-game" style="text-transform: uppercase">
            <i class="fas fa-crosshairs"></i><%= usersList[0].game %>
          </div>
          <div class="badge badge-success">Champion</div>

          <div class="podium-stats">
            <div class="podium-stat">
              <div class="podium-stat-value">
                Rs <%= usersList[0].earnings %>
              </div>
              <div class="podium-stat-label">Total Earnings</div>
            </div>
            <div class="podium-stat">
              <div class="podium-stat-value">Rs <%= usersList[0].maxWin %></div>
              <div class="podium-stat-label">Highest Win</div>
            </div>
          </div>
        </div>

        <!-- 2nd Place -->
        <div class="podium-player">
          <div class="podium-rank podium-2">2</div>
          <div class="podium-avatar">
            <img
              src="https://randomuser.me/api/portraits/women/44.jpg"
              alt="Player Avatar"
            />
          </div>
          <div class="podium-name rank-2-name"><%= usersList[1].ign %></div>
          <div class="podium-game" style="text-transform: uppercase">
            <i class="fab fa-fort-awesome"></i> <%= usersList[1].game %>
          </div>
          <div class="badge badge-primary">Pro Player</div>

          <div class="podium-stats">
            <div class="podium-stat">
              <div class="podium-stat-value">
                Rs <%= usersList[1].earnings %>
              </div>
              <div class="podium-stat-label">Total Earnings</div>
            </div>
            <div class="podium-stat">
              <div class="podium-stat-value">Rs <%= usersList[1].maxWin %></div>
              <div class="podium-stat-label">Highest Win</div>
            </div>
          </div>
        </div>

        <!-- 3rd Place -->
        <div class="podium-player">
          <div class="podium-rank podium-3">3</div>
          <div class="podium-avatar">
            <img
              src="https://randomuser.me/api/portraits/men/67.jpg"
              alt="Player Avatar"
            />
          </div>
          <div class="podium-name rank-3-name"><%= usersList[2].ign %></div>
          <div class="podium-game" style="text-transform: uppercase">
            <i class="fas fa-skull"></i><%= usersList[2].game %>
          </div>
          <div class="badge badge-primary">Pro Player</div>

          <div class="podium-stats">
            <div class="podium-stat">
              <div class="podium-stat-value">
                Rs <%= usersList[2].earnings %>
              </div>
              <div class="podium-stat-label">Total Earnings</div>
            </div>
            <div class="podium-stat">
              <div class="podium-stat-value">Rs <%= usersList[2].maxWin %></div>
              <div class="podium-stat-label">Highest Win</div>
            </div>
          </div>
        </div>
      </div>

      <div class="section-title">
        <h3><i class="fas fa-list-ol"></i> Full Leaderboard</h3>
        <span>Top 100 Players</span>
      </div>

      <div class="leaderboard-container">
        <div class="leaderboard-header">
          <div class="header-item">Rank</div>
          <div class="header-item">Player</div>
          <div class="header-item">Total Earnings</div>
          <div class="header-item">Highest Earnings</div>
          <div class="header-item">Matches</div>
          <div class="header-item">Status</div>
        </div>

        <!-- Player 1 -->
        <% usersList.forEach((user, index) => { %>
        <div class="leaderboard-row" id="rank-<%= index + 1 %>-player">
          <div class="rank rank-<%= index + 1 %>"><%= index + 1 %></div>

          <div class="player-info">
            <div class="player-avatar">
              <img
                src="<%= user.avatar || 'https://randomuser.me/api/portraits/men/' + (32 + index * 5) + '.jpg' %>"
                alt="<%= user.ign %>"
              />
            </div>
            <div>
              <div class="player-name"><%= user.ign %></div>
              <div class="player-game" style="text-transform: uppercase">
                <% if(user.game === 'bgmi') { %>
                <i class="fas fa-crosshairs"></i> <%= user.game %> <% } else
                if(user.game === 'ff') { %>
                <i class="fab fa-fort-awesome"></i> <%= user.game %> <% } else {
                %> <i class="fas fa-gamepad"></i> <%= user.game %> <% } %>
              </div>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-value earnings">Rs <%= user.earnings %></div>
          </div>
          <div class="stat-item">
            <div class="stat-value high-earnings">Rs <%= user.maxWin %></div>
          </div>
          <div class="stat-item">
            <div class="stat-value"><%= user.matchesPlayed %></div>
            <div class="stat-label">Matches</div>
          </div>
          <div class="stat-item">
            <div
              class="badge <%= user.status === 'active' ? 'badge-success' : 'badge-primary' %>"
            >
              <%= user.status %>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>

    <footer>
      <p>
        Â© 2025 NextScrimz. All rights reserved. | Competitive gaming at its
        finest
      </p>
    </footer>

    <script>
      const gameTypes = document.querySelectorAll(".game-type");

      gameTypes.forEach((game) => {
        game.addEventListener("click", (e) => {
          removeAllActiveFilters();
          addActiveListener(game);

          if (game.dataset.game === "bgmi") {
            filterGames("bgmi");
          } else if (game.dataset.game === "ff") {
            filterGames("ff");
          } else {
            filterGames("all-games");
          }
        });
      });

      function addActiveListener(game) {
        game.classList.add("active");
      }

      function removeAllActiveFilters() {
        gameTypes.forEach((game) => {
          game.classList.remove("active");
        });
      }

      async function filterGames(game) {
        try {
          const res = await fetch(`/leaderboard/${game}`, {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              "X-Requested-With": "XMLHttpRequest",
            },
          });
          const data = await res.json();

          if (res.ok) {
            console.log(data.usersList);
            makeList(data.usersList);
            
          } else {
            sendNotification("error", data.message, "Filter error!")
          }
        } catch (err) {
          sendNotification("error", "Server error, please reload the page", "Server error!")
          console.log("Error:", err);
        }
      }

      function makeList(users) {
        podiumList(users.slice(0, 3));
        fullList(users);
      }

      function podiumList(users) {
        const podiumContainer = document.getElementsByClassName("podium")[0];
        podiumContainer.innerHTML = "";

        const podiumConfig = [
          {
            rank: 1,
            avatar:
              "https://static.vecteezy.com/system/resources/thumbnails/054/555/561/small/a-man-wearing-headphones-and-sunglasses-is-wearing-a-hoodie-free-vector.jpg",
            badge: { text: "Champion", class: "badge-success" },
            icon: "fas fa-crosshairs",
          },
          {
            rank: 2,
            avatar: "https://randomuser.me/api/portraits/women/44.jpg",
            badge: { text: "Pro Player", class: "badge-primary" },
            icon: "fab fa-fort-awesome",
          },
          {
            rank: 3,
            avatar: "https://randomuser.me/api/portraits/men/67.jpg",
            badge: { text: "Pro Player", class: "badge-primary" },
            icon: "fas fa-skull",
          },
        ];

        podiumContainer.innerHTML = podiumConfig
          .map(
            (cfg, i) => `
      <div class="podium-player">
        <div class="podium-rank podium-${cfg.rank}">${cfg.rank}</div>
        <div class="podium-avatar">
          <img src="${cfg.avatar}" alt="Player Avatar" />
        </div>
        <div class="podium-name rank-${cfg.rank}-name">${
              users[i]?.ign || "N/A"
            }</div>
        <div class="podium-game" style="text-transform: uppercase">
          <i class="${cfg.icon}"></i> ${users[i]?.game || "N/A"}
        </div>
        <div class="badge ${cfg.badge.class}">${cfg.badge.text}</div>

        <div class="podium-stats">
          <div class="podium-stat">
            <div class="podium-stat-value">Rs ${users[i]?.earnings || 0}</div>
            <div class="podium-stat-label">Total Earnings</div>
          </div>
          <div class="podium-stat">
            <div class="podium-stat-value">Rs ${users[i]?.maxWin || 0}</div>
            <div class="podium-stat-label">Highest Win</div>
          </div>
        </div>
      </div>
    `
          )
          .join("");
      }

function fullList(users) {
  const listContainer = document.getElementsByClassName("leaderboard-container")[0];
  
  // Reset with header
  let content = `
    <div class="leaderboard-header">
      <div class="header-item">Rank</div>
      <div class="header-item">Player</div>
      <div class="header-item">Total Earnings</div>
      <div class="header-item">Highest Earnings</div>
      <div class="header-item">Matches</div>
      <div class="header-item">Status</div>
    </div>
  `;

  // Build rows
  content += users
    .map(
      (user, index) => `
        <div class="leaderboard-row" id="rank-${index + 1}-player">
          <div class="rank rank-${index + 1}">${index + 1}</div>

          <div class="player-info">
            <div class="player-avatar">
              <img
                src="${
                  user.avatar ||
                  "https://randomuser.me/api/portraits/men/" + (32 + index * 5) + ".jpg"
                }"
                alt="${user.ign}"
              />
            </div>
            <div>
              <div class="player-name">${user.ign}</div>
              <div class="player-game" style="text-transform: uppercase">
                <i class="fas fa-${
                  user.game === "bgmi" ? "crosshairs" : "gamepad"
                }"></i> ${user.game}
              </div>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-value earnings">Rs ${user.earnings}</div>
          </div>
          <div class="stat-item">
            <div class="stat-value high-earnings">Rs ${user.maxWin}</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">${user.matchesPlayed}</div>
            <div class="stat-label">Matches</div>
          </div>
          <div class="stat-item">
            <div class="badge ${
              user.status === "active" ? "badge-success" : "badge-primary"
            }">${user.status}</div>
          </div>
        </div>
      `
    )
    .join("");

  // Render once
  listContainer.innerHTML = content;
}

    </script>
  </body>
</html>
