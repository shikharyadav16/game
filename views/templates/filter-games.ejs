<script>
    function makeCard(games) {
        const container = document.getElementsByClassName("tournament-cards")[0];
        container.innerHTML = "";

        if (!games || games.length === 0) {
            container.innerHTML = `<div class="no-card">
                        <i class="ph ph-calendar-x"></i>
                        <div>No upcoming events â€” check back later</div>
                        </div>`;
            return;
        }

        games.forEach(game => {
            let regPlayers = game.eventArray.length;
            
            let totalPosPrize = 0
            game.eventPosPrize.forEach((prize)=> {
                totalPosPrize += prize.prize
            })
            let pp = game.eventSize * game.eventKillPrize + totalPosPrize;

            const cardHTML = `
            <div class="card">
                <div class="card-img">
                    <img src="https://images.unsplash.com/photo-1560419015-7c427e8ae5ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80"
                        alt="BGMI Tournament">
                    <div class="game-name">${game.eventType}</div>
                </div>
                <div class="card-content">
                    <h3 class="tournament-name">${game.eventName}</h3>

                    <div class="details">
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <div class="detail-text">
                                <span class="detail-label">Team Size</span>
                                <span class="detail-value"  style="text-transform: capitalize;">${game.eventTeamSize}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar"></i>
                            <div class="detail-text">
                                <span class="detail-label">Date & Time</span>
                                <span class="detail-value">${game.eventDate} | ${game.eventTime}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-trophy"></i>
                            <div class="detail-text">
                                <span class="detail-label">Prize Pool</span>
                                <span class="detail-value">Rs ${pp}</span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div class="detail-text">
                                <span class="detail-label">Region</span>
                                <span class="detail-value">India</span>
                            </div>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Slots Registered</span>
                            <span>${regPlayers}/${game.eventSize}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(regPlayers / game.eventSize) * 100}%"></div>
                        </div>
                    </div>

                    <div class="prizes">
                        <div class="prize-item">
                            <div class="prize-label">Per Kill</div>
                            <div class="prize-amount">Rs ${game.eventKillPrize}</div>
                        </div>
                        <div class="prize-item">
                            <div class="prize-label">1st Place</div>
                            <div class="prize-amount">Rs ${totalPosPrize}</div>
                        </div>
                    </div>

                    <div class="entry-fee">
                        <i class="fas fa-ticket-alt"></i> Entry Fee: Rs ${game.eventEntry} per slot
                    </div>

                    <div class="card-actions">
                        <button class="btn-details">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="btn-register" data-id="${game.eventId}" onclick="handleRegisterEvent(this.dataset.id)">
                            <i class="fas fa-user-plus"></i> Register
                        </button>
                    </div>
                </div>
            </div>
        `;

            container.insertAdjacentHTML("beforeend", cardHTML);
        });
    }

</script>

<script>

    const solo = document.getElementById("solo")
    const duo = document.getElementById("duo")
    const squad = document.getElementById("squad")
    const allGames = document.getElementById("all-games");

    function removeAllActiveFilters() {
        solo.classList.remove("active")
        duo.classList.remove("active")
        squad.classList.remove("active")
        allGames.classList.remove("active")
    }
    allGames.addEventListener("click", () => {
        removeAllActiveFilters();
        allGames.classList.add("active");
        filterGames("all-games");
    })
    solo.addEventListener("click", () => {
        removeAllActiveFilters();
        solo.classList.add("active");
        filterGames("solo");
    })
    duo.addEventListener("click", () => {
        removeAllActiveFilters();
        duo.classList.add("active");
        filterGames("duo");
    })
    squad.addEventListener("click", () => {
        removeAllActiveFilters();
        squad.classList.add("active");
        filterGames("squad");
    })

    async function filterGames(teamSize) {
        try {
            const res = await fetch(`/games/${teamSize}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "X-Requested-With": "XMLHttpRequest"
                }
            });
            const data = await res.json();

            if (res.ok) {
                makeCard(data.games);
            }
        } catch (err) {
            console.log("Error:", err)
        }
    }

</script>